<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>迷宫大小显示测试</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .test-header h1 {
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        
        .test-cases {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-case {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-case h3 {
            color: #a5b4fc;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .maze-canvas {
            width: 100%;
            height: 300px;
            background: #0f172a;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .test-info {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .test-info strong {
            color: #cbd5e1;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .control-btn {
            flex: 1;
            padding: 10px;
            background: rgba(76, 201, 240, 0.2);
            border: 1px solid rgba(76, 201, 240, 0.3);
            color: #4cc9f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(76, 201, 240, 0.3);
        }
        
        .test-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .test-summary h3 {
            color: #4cc9f0;
            margin-bottom: 15px;
        }
        
        .summary-item {
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }
        
        .summary-item.success {
            border-left: 4px solid #10b981;
        }
        
        .summary-item.warning {
            border-left: 4px solid #f59e0b;
        }
        
        .summary-item.error {
            border-left: 4px solid #ef4444;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>迷宫大小显示测试</h1>
            <p>测试不同大小的迷宫显示效果，验证自适应渲染和滚动功能</p>
        </div>
        
        <div class="test-cases">
            <div class="test-case">
                <h3>小迷宫 <span>10×10</span></h3>
                <canvas id="mazeSmall" class="maze-canvas" width="400" height="300"></canvas>
                <div class="test-info">
                    <p><strong>预期效果:</strong> 迷宫应居中显示，不会蜷缩在左上角</p>
                    <p><strong>Canvas尺寸:</strong> <span id="sizeSmall">计算中...</span></p>
                    <p><strong>缩放比例:</strong> <span id="scaleSmall">计算中...</span></p>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="testMaze(10)">测试10×10</button>
                </div>
            </div>
            
            <div class="test-case">
                <h3>标准迷宫 <span>15×15</span></h3>
                <canvas id="mazeStandard" class="maze-canvas" width="400" height="300"></canvas>
                <div class="test-info">
                    <p><strong>预期效果:</strong> 迷宫应完整显示在Canvas中</p>
                    <p><strong>Canvas尺寸:</strong> <span id="sizeStandard">计算中...</span></p>
                    <p><strong>缩放比例:</strong> <span id="scaleStandard">计算中...</span></p>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="testMaze(15)">测试15×15</button>
                </div>
            </div>
            
            <div class="test-case">
                <h3>大迷宫 <span>20×20</span></h3>
                <canvas id="mazeLarge" class="maze-canvas" width="400" height="300"></canvas>
                <div class="test-info">
                    <p><strong>预期效果:</strong> 迷宫应自适应缩放或启用滚动</p>
                    <p><strong>Canvas尺寸:</strong> <span id="sizeLarge">计算中...</span></p>
                    <p><strong>缩放比例:</strong> <span id="scaleLarge">计算中...</span></p>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="testMaze(20)">测试20×20</button>
                </div>
            </div>
            
            <div class="test-case">
                <h3>超大迷宫 <span>25×25</span></h3>
                <canvas id="mazeXLarge" class="maze-canvas" width="400" height="300"></canvas>
                <div class="test-info">
                    <p><strong>预期效果:</strong> 应启用滚动功能显示完整迷宫</p>
                    <p><strong>Canvas尺寸:</strong> <span id="sizeXLarge">计算中...</span></p>
                    <p><strong>缩放比例:</strong> <span id="scaleXLarge">计算中...</span></p>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="testMaze(25)">测试25×25</button>
                </div>
            </div>
        </div>
        
        <div class="test-summary">
            <h3>测试结果</h3>
            <div id="testResults">
                <div class="summary-item">
                    点击上面的按钮开始测试...
                </div>
            </div>
            <div class="controls">
                <button class="control-btn" onclick="runAllTests()">运行所有测试</button>
                <button class="control-btn" onclick="clearResults()">清除结果</button>
            </div>
        </div>
    </div>

    <script src="maze.js"></script>
    <script src="view.js"></script>
    <script src="raycast.js"></script>
    <script src="game.js"></script>
    <script src="ui.js"></script>
    
    <script>
        // 测试数据
        const testCases = [
            { id: 'mazeSmall', size: 10, name: '小迷宫 (10×10)' },
            { id: 'mazeStandard', size: 15, name: '标准迷宫 (15×15)' },
            { id: 'mazeLarge', size: 20, name: '大迷宫 (20×20)' },
            { id: 'mazeXLarge', size: 25, name: '超大迷宫 (25×25)' }
        ];
        
        // 游戏实例缓存
        const gameInstances = {};
        const uiInstances = {};
        
        // 初始化测试
        function initTest() {
            testCases.forEach(testCase => {
                const canvas = document.getElementById(testCase.id);
                const ctx = canvas.getContext('2d');
                
                // 创建游戏实例
                const game = new Game({
                    mazeSize: testCase.size,
                    viewMode: 'permanent'
                });
                
                // 创建UI控制器
                const ui = new UIController({
                    canvasId: testCase.id,
                    game: game,
                    enableScroll: true,
                    maxCanvasSize: 600
                });
                
                gameInstances[testCase.id] = game;
                uiInstances[testCase.id] = ui;
                
                // 开始游戏
                game.start();
                
                // 更新显示信息
                updateDisplayInfo(testCase.id);
            });
        }
        
        // 更新显示信息
        function updateDisplayInfo(canvasId) {
            const ui = uiInstances[canvasId];
            if (!ui) return;
            
            const sizeElement = document.getElementById(`size${getSizeLabel(canvasId)}`);
            const scaleElement = document.getElementById(`scale${getSizeLabel(canvasId)}`);
            
            if (sizeElement && scaleElement) {
                sizeElement.textContent = `${ui.canvas.width}×${ui.canvas.height}`;
                scaleElement.textContent = ui.canvasScale.toFixed(2);
            }
        }
        
        // 获取尺寸标签
        function getSizeLabel(canvasId) {
            switch(canvasId) {
                case 'mazeSmall': return 'Small';
                case 'mazeStandard': return 'Standard';
                case 'mazeLarge': return 'Large';
                case 'mazeXLarge': return 'XLarge';
                default: return '';
            }
        }
        
        // 测试特定大小的迷宫
        function testMaze(size) {
            const testCase = testCases.find(tc => tc.size === size);
            if (!testCase) return;
            
            const game = gameInstances[testCase.id];
            const ui = uiInstances[testCase.id];
            
            if (!game || !ui) return;
            
            // 更改迷宫大小
            game.setMazeSize(size);
            
            // 更新Canvas尺寸
            ui.updateCanvasSize();
            
            // 重新渲染
            ui.render();
            
            // 更新显示信息
            updateDisplayInfo(testCase.id);
            
            // 记录测试结果
            recordTestResult(testCase, ui);
        }
        
        // 记录测试结果
        function recordTestResult(testCase, ui) {
            const resultsDiv = document.getElementById('testResults');
            const canvas = ui.canvas;
            const container = canvas.parentElement;
            
            // 检查显示效果
            let status = 'success';
            let message = '';
            
            if (testCase.size <= 15) {
                // 小迷宫和标准迷宫应该居中显示
                const mazeWidth = testCase.size * ui.config.cellSize * ui.canvasScale;
                const containerWidth = container ? container.clientWidth : 400;
                
                if (mazeWidth < containerWidth * 0.5) {
                    status = 'warning';
                    message = `迷宫可能过小，仅占用${Math.round((mazeWidth / containerWidth) * 100)}%宽度`;
                } else {
                    message = `显示正常，居中显示`;
                }
            } else if (testCase.size <= 20) {
                // 大迷宫应该自适应缩放
                if (ui.canvasScale < 0.7) {
                    status = 'warning';
                    message = `缩放比例较低 (${ui.canvasScale.toFixed(2)})，但可以接受`;
                } else {
                    message = `自适应缩放正常 (${ui.canvasScale.toFixed(2)})`;
                }
            } else {
                // 超大迷宫应该启用滚动
                const needsScroll = ui.config.enableScroll && 
                                  (testCase.size * ui.config.cellSize > ui.config.maxCanvasSize);
                
                if (needsScroll) {
                    message = `滚动功能已启用，Canvas尺寸: ${canvas.width}×${canvas.height}`;
                } else {
                    status = 'warning';
                    message = `可能未启用滚动，建议检查`;
                }
            }
            
            // 添加结果
            const resultItem = document.createElement('div');
            resultItem.className = `summary-item ${status}`;
            resultItem.innerHTML = `
                <strong>${testCase.name}</strong><br>
                ${message}<br>
                <small>Canvas: ${canvas.width}×${canvas.height}, 缩放: ${ui.canvasScale.toFixed(2)}</small>
            `;
            
            resultsDiv.insertBefore(resultItem, resultsDiv.firstChild);
            
            // 限制结果数量
            const items = resultsDiv.querySelectorAll('.summary-item');
            if (items.length > 10) {
                items[items.length - 1].remove();
            }
        }
        
        // 运行所有测试
        function runAllTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="summary-item">正在运行所有测试...</div>';
            
            setTimeout(() => {
                resultsDiv.innerHTML = '';
                testCases.forEach((testCase, index) => {
                    setTimeout(() => {
                        testMaze(testCase.size);
                    }, index * 500);
                });
            }, 100);
        }
        
        // 清除结果
        function clearResults() {
            document.getElementById('testResults').innerHTML = 
                '<div class="summary-item">点击上面的按钮开始测试...</div>';
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', () => {
            setTimeout(initTest, 500);
        });
    </script>
</body>
</html>